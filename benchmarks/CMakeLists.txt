CMAKE_MINIMUM_REQUIRED (VERSION 2.8)

FIND_PACKAGE (Threads REQUIRED)
INCLUDE_DIRECTORIES (${Threads_INCLUDE_DIR})

FIND_PACKAGE (Boost COMPONENTS program_options REQUIRED)
INCLUDE_DIRECTORIES (${Boost_INCLUDE_DIR})

SET (BENCHMARK_LINK_FLAGS "-Wl,-rpath,${CMAKE_CURRENT_BINARY_DIR}:${CMAKE_CURRENT_BINARY_DIR}/../${CMAKE_LIBRARY_OUTPUT_DIRECTORY}")
SET (BENCHMARK_PROPERTIES PROPERTIES LINK_FLAGS "${BENCHMARK_LINK_FLAGS}" LINKER_LANGUAGE CXX)
SET (BENCHMARK_LIBRARIES ${Boost_LIBRARIES} ${PROJECT_NAME} ${CMAKE_THREAD_LIBS_INIT})

ADD_CUSTOM_TARGET(benchmarks)

ADD_EXECUTABLE (load EXCLUDE_FROM_ALL ${CMAKE_CURRENT_SOURCE_DIR}/load.cpp)
SET_TARGET_PROPERTIES (load ${BENCHMARK_PROPERTIES})
TARGET_LINK_LIBRARIES (load ${BENCHMARK_LIBRARIES})
ADD_DEPENDENCIES (benchmarks load)

FILE (COPY run_load.sh DESTINATION ${CMAKE_CURRENT_BINARY_DIR})
